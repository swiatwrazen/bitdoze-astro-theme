---
import { Icon } from "astro-icon/components";
import { getCollection } from "astro:content";
import menu from "@config/menu.json";
import social from "@config/social.json";
import { siteConfig } from "@config/site";
import { company, phone, email, address } from "@config/company";

const footerMenu = menu.footer ?? [];
const socialLinks = Object.entries(social)
  .filter(([, url]) => Boolean(url))
  .map(([platform, url]) => ({ platform, url }))
  .slice(0, 6);

const allPosts = await getCollection("posts", ({ data }) => !data.draft);
const recentPosts = allPosts
  .sort((a, b) => new Date(b.data.date || 0).getTime() - new Date(a.data.date || 0).getTime())
  .slice(0, 3);

const currentYear = new Date().getFullYear();
const brandParts = company.name.split(" ").filter(Boolean);
const brandPrimary = brandParts[0] ?? siteConfig.name;
const brandSecondary = brandParts.slice(1).join(" ");
---

<footer class="mt-16 bg-brand-blue text-white">
  <div class="container py-16">
    <div class="grid gap-12 lg:grid-cols-4">
      <div class="space-y-6">
        <p class="text-3xl font-black text-white">
          {brandPrimary}
          {brandSecondary && (
            <span class="ml-2 inline-flex rounded-lg bg-white px-3 text-brand-navy">{brandSecondary}</span>
          )}
        </p>
        <p class="max-w-xs text-base/relaxed text-white/80">{company.slogan}</p>
        <div class="flex flex-wrap items-center gap-3">
          {socialLinks.map(({ platform, url }) => (
            <a
              href={url}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex size-10 items-center justify-center rounded-full bg-white/10 text-white transition hover:bg-white hover:text-brand-blue"
              aria-label={`Follow on ${platform}`}
            >
              <Icon name={`mdi:${platform}`} class="size-5" />
            </a>
          ))}
        </div>
      </div>

      <div class="space-y-4">
        <h2 class="text-lg font-semibold uppercase tracking-wide text-white">Menu</h2>
        <ul class="space-y-2 text-white/80">
          {footerMenu.map((item) => (
            <li>
              <a href={item.url} class="transition hover:text-white">
                {item.name}
              </a>
            </li>
          ))}
        </ul>
      </div>

      <div class="space-y-4">
        <h2 class="text-lg font-semibold uppercase tracking-wide text-white">Kontakt</h2>
        <div class="space-y-2 text-white/80">
          <a href={phone.href} class="block transition hover:text-white">
            {phone.label}
          </a>
          <a href={email.href} class="block transition hover:text-white">
            {email.label}
          </a>
          <p>
            {address.street}
            <br />
            {address.zip} {address.city}
            <br />
            {address.country}
          </p>
        </div>
      </div>

      <div class="space-y-4">
        <h2 class="text-lg font-semibold uppercase tracking-wide text-white">Najnowsze wpisy</h2>
        <ul class="space-y-3">
          {
            recentPosts.map((post) => (
              <li>
                <a
                  href={`/${post.slug}/`}
                  class="block rounded-xl border border-white/10 p-3 transition hover:border-white hover:bg-white/10"
                >
                  <p class="text-sm font-semibold text-white line-clamp-2">{post.data.title}</p>
                  {post.data.date && (
                    <span class="mt-1 block text-xs text-white/70">
                      {new Date(post.data.date).toLocaleDateString("pl-PL")}
                    </span>
                  )}
                </a>
              </li>
            ))
          }
        </ul>
      </div>
    </div>
  </div>
  <div class="border-t border-white/20 bg-brand-blue/90">
    <div class="container py-6 text-center text-sm text-white/80">
      &copy; {currentYear} {siteConfig.name}. Wszystkie prawa zastrzezone.
    </div>
  </div>
</footer>
