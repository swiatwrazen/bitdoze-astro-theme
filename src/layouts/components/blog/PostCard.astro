---
import { Image } from 'astro:assets';
import { Icon } from 'astro-icon/components';
import { formatDate } from '@utils/date';
import SeriesBadge from './SeriesBadge.astro';

const { post } = Astro.props;
const { title, description, image, date, categories, authors, series } = post.data;

// Extract the slug from the canonical URL or use the file name
const slug = post.data.canonical 
  ? new URL(post.data.canonical).pathname.split('/').filter(Boolean).pop()
  : post.slug;

// Check if post is part of a series
const isPartOfSeries = series && Array.isArray(series) && series.length === 2;
---

<article class="flex h-full flex-col overflow-hidden rounded-3xl bg-white shadow-xl ring-1 ring-brand-blue/10 transition duration-300 hover:-translate-y-1" >
  <!-- Post Image -->
  {image && (
    <a href={`/${slug}/`} class="block aspect-video overflow-hidden">
      <Image 
        src={image} 
        alt={title} 
        class="h-full w-full object-cover transition duration-300 hover:scale-105"
        width={640}
        height={360}
      />
    </a>
  )}
  
  <div class="flex flex-1 flex-col p-6">
    <div class="mb-4 flex flex-wrap items-center justify-between gap-2">
      <!-- Categories -->
      {categories && categories.length > 0 && (
        <div class="flex flex-wrap gap-2">
          {categories.map((category: string) => (
            <a 
              href={`/categories/${category.toLowerCase()}/`} 
              class="rounded-full bg-brand-blue/10 px-3 py-1 text-xs font-semibold text-brand-blue transition hover:bg-brand-blue/20"
            >
              {category}
            </a>
          ))}
        </div>
      )}
      
      <!-- Series Badge (if part of a series) -->
      {isPartOfSeries && (
        <SeriesBadge 
          seriesName={series[0]} 
          seriesPosition={series[1]}
          size="sm"
        />
      )}
    </div>
    
    <!-- Title -->
    <h2 class="text-2xl font-semibold text-brand-blue">
      <a href={`/${slug}/`} class="line-clamp-2 transition hover:text-brand-blue/80">
        {title}
      </a>
    </h2>
    
    <!-- Description -->
    {description && (
      <p class="mt-3 line-clamp-3 text-base text-gray-600">
        {description}
      </p>
    )}
    
    <div class="mt-auto flex items-center justify-between pt-6 text-sm text-gray-500">
      <!-- Author -->
      {authors && authors.length > 0 && (
        <div class="flex items-center">
          <Icon name="mdi:account" class="mr-2 h-4 w-4 text-brand-blue" />
          <span>{authors[0]}</span>
        </div>
      )}
      
      <!-- Date -->
      {date && (
        <div class="flex items-center">
          <Icon name="mdi:calendar" class="mr-2 h-4 w-4 text-brand-blue" />
          <time datetime={date.toISOString()}>
            {formatDate(date)}
          </time>
        </div>
      )}
    </div>
  </div>
</article>
